# TODO: What's Needed to Start Saving Claude Tokens

**Current Status:** Infrastructure 100% ready, External setup needed  
**Time to complete:** 1-2 hours  
**Token savings once done:** 70-85%

---

## Critical Path (Must Do)

### ‚òê 1. Get API Keys for Gemini or Qwen

**You need at least ONE of these:**

#### Option A: Google Gemini (Recommended)
```
Service: Google AI Studio / Vertex AI
URL: https://aistudio.google.com/app/apikey
Cost: Free tier available (60 requests/min)
API Key format: AIza...
```

**Steps:**
1. Go to https://aistudio.google.com/app/apikey
2. Sign in with Google account
3. Click "Create API Key"
4. Copy the key (starts with `AIza`)

#### Option B: Alibaba Qwen
```
Service: DashScope (Alibaba Cloud)
URL: https://dashscope.console.aliyun.com/
Cost: Free tier available
API Key format: sk-...
```

**Steps:**
1. Go to https://dashscope.console.aliyun.com/
2. Sign up / Sign in
3. Create API key
4. Copy the key

**Decision:** Choose Gemini (easier for English) or Qwen (cheaper, good for bilingual)

---

### ‚òê 2. Install CLI Tool

**You need the command-line tool to call the API:**

#### For Gemini:

**Option 1: Use Python SDK (Recommended)**
```bash
# Install Google Generative AI SDK
pip install google-generativeai
```

**Option 2: Use Node.js SDK**
```bash
npm install -g @google/generative-ai
```

#### For Qwen:

```bash
# Install DashScope SDK
pip install dashscope
```

**Quick Test:**
```python
# test_gemini.py
import google.generativeai as genai

genai.configure(api_key="YOUR_API_KEY_HERE")
model = genai.GenerativeModel('gemini-1.5-pro')
response = model.generate_content("Say hello!")
print(response.text)
```

Run: `python test_gemini.py`  
Expected: "Hello!" or similar greeting

---

### ‚òê 3. Configure Environment Variables

Add API key to your system:

#### Windows (PowerShell):
```powershell
# Set for current session
$env:GEMINI_API_KEY = "AIza..."

# Set permanently (User level)
[System.Environment]::SetEnvironmentVariable("GEMINI_API_KEY", "AIza...", "User")

# Or for Qwen
$env:QWEN_API_KEY = "sk-..."
```

#### Or add to backend/.env:
```bash
# backend/.env
GEMINI_API_KEY=AIza...
QWEN_API_KEY=sk-...
```

**Verify:**
```powershell
echo $env:GEMINI_API_KEY
# Should show: AIza...
```

---

### ‚òê 4. Update dispatch.ps1 with API Call

**Current state:** dispatch.ps1 has TODO placeholder  
**Need to add:** Actual API call

**Find this section in dispatch.ps1** (around line 100):
```powershell
# TODO: Integrate with Gemini/Qwen CLI
# Example:
# $prompt = "$agentInstructions`n`n## Task`n$Task`n`n## Available Skills`n$skillContext"
# & gemini-cli --prompt $prompt
```

**Replace with:**

#### For Gemini (Python SDK):
```powershell
if ($Execute) {
    Write-ColorOutput "[RUN] Calling Gemini API..." "Cyan"
    
    # Build prompt
    $prompt = @"
$agentInstructions

## Task
$Task

## Available Skills
$skillContext
"@
    
    # Save prompt to temp file
    $promptFile = Join-Path $ScriptDir "temp-prompt.txt"
    $prompt | Set-Content $promptFile -Encoding UTF8
    
    # Call Gemini via Python
    $pythonScript = @"
import os
import google.generativeai as genai

genai.configure(api_key=os.getenv('GEMINI_API_KEY'))
model = genai.GenerativeModel('gemini-1.5-pro')

with open('$promptFile', 'r', encoding='utf-8') as f:
    prompt = f.read()

response = model.generate_content(prompt)
print(response.text)
"@
    
    $scriptFile = Join-Path $ScriptDir "call-gemini.py"
    $pythonScript | Set-Content $scriptFile -Encoding UTF8
    
    # Execute
    $output = python $scriptFile
    
    # Display result
    Write-ColorOutput "`n[OUTPUT] Gemini Response:" "Green"
    Write-Output $output
    
    # Save to file
    $outputFile = Join-Path $ScriptDir "last-agent-output.txt"
    $output | Set-Content $outputFile -Encoding UTF8
    Write-ColorOutput "`nOutput saved to: $outputFile" "Gray"
    
    # Cleanup
    Remove-Item $promptFile, $scriptFile
}
```

**Save and test!**

---

### ‚òê 5. Test the Full System

**Simple test:**
```powershell
cd C:\Users\SM TRADERs\Downloads\Hackathon-1

.\reusable-intelligence\dispatch.ps1 `
    -Agent content-agent `
    -Task "Write a 3-sentence introduction to AI robotics" `
    -Execute
```

**Expected output:**
```
[RUN] EXECUTION MODE
========================================
[RUN] Calling Gemini API...

[OUTPUT] Gemini Response:
Artificial Intelligence robotics combines machine learning...
[3 sentences generated by Gemini]

Output saved to: .\reusable-intelligence\last-agent-output.txt
```

**If this works, YOU'RE DONE! üéâ**

---

## Optional (For Better Experience)

### ‚òê 6. Update CLAUDE.md with Delegation Instructions

Add to the top of `CLAUDE.md`:

```markdown
# CRITICAL: Token-Saving Delegation

Before implementing ANY complex task (>500 lines), check if it should be delegated:

1. **Check keywords:** See `.claude/commands/auto-delegate.md` for detection rules
2. **If delegatable:** Tell user to run dispatch.ps1
3. **Provide exact command:**
   ```powershell
   .\reusable-intelligence\dispatch.ps1 `
       -Agent <agent-name> `
       -Task "<detailed task with full context>" `
       -Skills "<relevant-skills>" `
       -Execute
   ```
4. **Review output:** Once user shares the result, review and integrate
5. **Report:** Explain what was created and how to use it

## Token Savings Target: 70-85%
```

### ‚òê 7. Create Quick Reference Card

```powershell
# save as: quick-delegate.md

# Quick Delegation Reference

## When to Delegate
- Auth tasks ‚Üí better-auth-agent
- UI/React ‚Üí nextjs-agent
- RAG/Chatbot ‚Üí chatkit-agent
- Backend API ‚Üí sdk-agent
- Testing ‚Üí testing-agent
- Deployment ‚Üí deployment-agent

## Command Template
.\reusable-intelligence\dispatch.ps1 -Agent <agent> -Task "<task>" -Skills "<skills>" -Execute

## Common Combos
# Auth
-Agent better-auth-agent -Skills "better-auth-patterns,fastapi-patterns"

# UI Component
-Agent nextjs-agent -Skills "visual-excellence,docusaurus-patterns"

# RAG Endpoint
-Agent chatkit-agent -Skills "fastapi-patterns"
```

### ‚òê 8. Test in a Conversation with Claude

**Example conversation:**

```
You: "Claude, I need to implement signup/login with Better Auth. 
Should we delegate this?"

Claude: [Analyzes using auto-delegate.md rules]
"Yes, this is ideal for delegation to save ~70% tokens.

Please run:
.\reusable-intelligence\dispatch.ps1 `
    -Agent better-auth-agent `
    -Task "Implement signup/login..." `
    -Skills "better-auth-patterns,fastapi-patterns" `
    -Execute

Then share the output and I'll help integrate."

You: [Run command, copy output]
"Here's what Gemini generated: [paste output]"

Claude: [Reviews output]
"Perfect! The agent created these files:
- backend/app/routes/auth.py
- frontend/src/components/Auth/LoginForm.tsx

Let me help you integrate them..."
```

---

## Summary Checklist

### Must Do (To Start Saving Tokens):
- [ ] Get Gemini or Qwen API key (15 min)
- [ ] Install Python SDK (`pip install google-generativeai`) (5 min)
- [ ] Set environment variable (`$env:GEMINI_API_KEY = "..."`) (2 min)
- [ ] Update dispatch.ps1 with API call code (10 min)
- [ ] Test with simple task (5 min)

**Total time: ~40 minutes**  
**Result: 70-85% token savings on delegated tasks** ‚úÖ

### Optional (For Better UX):
- [ ] Update CLAUDE.md with delegation instructions
- [ ] Create quick reference card
- [ ] Test in conversation with Claude
- [ ] Set up centralized reusable-intelligence hub

---

## Troubleshooting

### Issue: "API key not found"
**Solution:** 
```powershell
# Verify environment variable is set
echo $env:GEMINI_API_KEY

# If empty, set it:
$env:GEMINI_API_KEY = "AIza..."
```

### Issue: "Python module not found"
**Solution:**
```bash
pip install google-generativeai
```

### Issue: "Rate limit exceeded"
**Solution:** 
- Wait a minute and retry
- Use Gemini 1.5 Flash for faster tasks (higher limit)
- Consider upgrading API plan

### Issue: "Output is incomplete"
**Solution:**
- Check token limits for the model
- Break task into smaller subtasks
- Use streaming for long outputs

---

## Next Action

**START HERE:**
1. Go to https://aistudio.google.com/app/apikey
2. Get your free Gemini API key
3. Run `pip install google-generativeai`
4. Test with the Python script above
5. Update dispatch.ps1 with the API call code
6. Run your first delegation!

**Once working, you'll save massively on Claude tokens!** üöÄ
